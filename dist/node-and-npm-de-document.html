<h1>Node und npm</h1>
<h1>Node.js und npm</h1>
<h2>Node.js</h2>
<p>Node.js ist eine JavaScript Runtime</p>
<p>Verwendung für:</p>
<ul>
<li>lokales ausführen von Scripts</li>
<li>Entwicklerwerkzeuge (z.B. Build-Prozess, Unittests, ...)</li>
<li>Backend ausführen</li>
</ul>
<h2>npm</h2>
<p><em>npm</em> = <em>Node package manager</em></p>
<p>ist in der node.js-Installation beinhaltet</p>
<h2>Node.js Installation</h2>
<p>Download von <a href="https://nodejs.org">https://nodejs.org</a></p>
<p>Major Releases alle 6 Monate; Long-Term-Support Releases alle 12 Monate</p>
<h1>npm</h1>
<h2>npm Registry</h2>
<p>Die npm Registry enthält hauptsächlich open source JavaScript Pakete</p>
<p>Mit <a href="http://www.modulecounts.com/">über 1 Million Pakete</a> die bei weitem größte Software Registry</p>
<p>Beispiele <a href="https://www.npmjs.com/browse/depended">most depended upon packages</a></p>
<h2>Package Manager</h2>
<p>zwei wichtige Package Manager für die npm Registry:</p>
<ul>
<li><em>npm</em>: Node package manager, in <em>node.js</em> beinhaltet</li>
<li><em>yarn</em>: Kann zusätzlich installiert werden</li>
</ul>
<h2>Paketkonfiguration</h2>
<p>Sowohl öffentliche Pakete als auch private Projekte werden über die Konfigurationsdatei <em>package.json</em> konfiguriert</p>
<h2>Paketkonfiguration</h2>
<p>Um Abhängigkeiten zu installieren können wir mit einer leeren <em>package.json</em> beginnen:</p>
<pre><code class="hljs language-json">{}
</code></pre>
<p>Alternative: <em>package.json</em> mit Inhalten mittels <code>npm init</code> (oder <code>npm init -y</code> für Standardoptionen) erstellen</p>
<h2>Abhängigkeiten hinzufügen</h2>
<p>Beispiel zur Installation von Abhängigkeiten:</p>
<pre><code class="hljs language-bash">npm install lodash bootstrap
</code></pre>
<h2>Abhängigkeiten hinzufügen</h2>
<p>Wenn wir eine Library entwickeln, die wir in der npm Registry veröffentlichen wollen:</p>
<p>Abhängigkeiten, die nur für die Entwicklung, nicht für die Verwendung von Bedeutung sind werden als <em>dev-dependencies</em> installiert:</p>
<pre><code class="hljs language-bash">npm install eslint --save-dev
</code></pre>
<h2>Abhängigkeiten hinzufügen</h2>
<p>Auswirkungen der bisherigen <code>npm install</code> Befehle:</p>
<ul>
<li><code>package.json</code> - listet Minimalversionen der gerade installierten Pakete</li>
<li><code>node_modules</code> - Ordner, der alle installierten Pakete enthält</li>
<li><code>package-lock.json</code> - listet exakte Versionen aller Pakete in <code>node_modules</code> auf</li>
</ul>
<h2>Abhängigkeiten in package.json</h2>
<p>Die Datei <code>package.json</code> listet nun Abhängigkeiten gemeinsam mit deren Version auf.</p>
<p>Die Version verwendet <em>semantic versioning</em>: <code>major.minor.patch</code></p>
<p>Mögliche Konfigurationen:</p>
<ul>
<li><code>"bootstrap": "4.3.1"</code> - genau diese Version</li>
<li><code>"bootstrap": "~4.3.1"</code> - Updates der Patch-Version sind erlaubt - z.B. auf <code>4.3.2</code></li>
<li><code>"bootstrap": "^4.3.1"</code> - Updates der Minor-Version sind erlaubt - z.B. auf <code>4.4.0</code></li>
</ul>
<h2>Abhängigkeiten in package-lock.json</h2>
<p><code>package-lock.json</code> listet <em>exakte</em> Versionen aller Abhängigkeiten (und derer Abhängigkeiten ...)</p>
<h2>node_modules Ordner</h2>
<p>enthält die tatsächlichen Pakete</p>
<p>sollte nicht unter Versionskontrolle stehen - kann stattdessen aus <code>package.json</code> neu generiert werden - durch ausführen von <code>npm install</code> ohne Argumente</p>
<h2>npm Scripts</h2>
<p>Npm kann verwendet werden, um Scripts / Befehle auszuführen, z.B.:</p>
<ul>
<li><code>npm run test</code> - würde Unit Tests ausführen</li>
<li><code>npm run build</code> - würde einen Build erstellen</li>
<li><code>npm run start</code></li>
<li><code>npm run deploy</code></li>
</ul>
<p>Manche npm Scripts haben Abkürzungen, insbesondere <code>npm test</code> und <code>npm start</code></p>
<h2>npm scripts</h2>
<p>Npm Scripts werden <code>package.json</code> konfiguriert:</p>
<pre><code class="hljs language-json">{
  <span class="hljs-attr">"scripts"</span>: { <span class="hljs-attr">"start"</span>: <span class="hljs-string">"node run-server.js"</span> }
}
</code></pre>
<h2>Globale Installation und npx</h2>
<p>Node Pakete können global auf einem Computer installiert werden oder direkt aus der npm Registry ausgeführt werden</p>
<p>direkte Ausführung (ohne Installation):</p>
<pre><code class="hljs language-bash">npx cowsay hello
</code></pre>
<p>globale Installation von <code>cowsay</code>:</p>
<pre><code class="hljs language-bash">npm install -g cowsay

cowsay hello
</code></pre>
<h1>Ausführen von Node-Programmen</h1>
<h2>Ausführen von Programmen im Terminal</h2>
<p>hello.js:</p>
<pre><code class="hljs language-js"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Hello world!'</span>);
</code></pre>
<pre><code class="hljs language-bash">node hello.js
</code></pre>
<h2>Ausführen von Programmen in VS Code</h2>
<p>Mit Debugging: <em>F5</em></p>
<p>Ohne Debugging: <em>Ctrl</em> + <em>F5</em></p>
<h2>Ausführen von Programmen in VS Code</h2>
<p>festlegen, wie JavaScript-Dateien ausgeführt werden sollen:</p>
<p>in der Befehlspalette, suche nach <em>Debug: Open launch.json</em> und wähle <em>Node.js</em> als Umgebung</p>
<p>der Befehl erstellt eine neue Datei unter <em>.vscode/launch.json</em></p>
<h2>Ausführen von Programmen in VS Code</h2>
<p>Mögliche Konfigurationseinträge (<em>.vscode/launch.json</em>):</p>
<pre><code class="hljs language-json">{
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Run current file"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"node"</span>,
  <span class="hljs-attr">"request"</span>: <span class="hljs-string">"launch"</span>,
  <span class="hljs-attr">"program"</span>: <span class="hljs-string">"${file}"</span>,
  <span class="hljs-attr">"skipFiles"</span>: [<span class="hljs-string">"&#x3C;node_internals>/**"</span>]
}
</code></pre>
<pre><code class="hljs language-json">{
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Run index.js"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"node"</span>,
  <span class="hljs-attr">"request"</span>: <span class="hljs-string">"launch"</span>,
  <span class="hljs-attr">"program"</span>: <span class="hljs-string">"${workspaceFolder}/index.js"</span>,
  <span class="hljs-attr">"skipFiles"</span>: [<span class="hljs-string">"&#x3C;node_internals>/**"</span>]
}
</code></pre>
<h1>Module</h1>
<h2>Module</h2>
<p>Node-Programme können Objekte aus sogenannten Modulen importieren</p>
<p>Kategorien:</p>
<ul>
<li>eingebaute Module (built-ins)</li>
<li>Module von <em>npm</em></li>
<li>Module im lokalen Verzeichnis</li>
</ul>
<h2>Importieren von Modulen</h2>
<p>moderne Möglichkeit:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;

<span class="hljs-keyword">const</span> currentDirectoryContent = fs.readdirSync(<span class="hljs-string">'.'</span>);
<span class="hljs-built_in">console</span>.log(currentDirectoryContent);
</code></pre>
<p>ältere Syntax:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-keyword">const</span> currentDirectoryContent = fs.readdirSync(<span class="hljs-string">'.'</span>);
<span class="hljs-built_in">console</span>.log(currentDirectoryContent);
</code></pre>
<h2>Importieren von Modulen</h2>
<p>für Verwendung der moderneren Syntax: in <em>package.json</em>  als <em>"module"</em> deklarieren (benötigt node ≥ 13):</p>
<pre><code class="hljs language-json"><span class="hljs-string">"type"</span>: <span class="hljs-string">"module"</span>
</code></pre>
<h2>Importieren von Modulen</h2>
<p>auf die moderne Syntax kann auch individuell in einzelnen Dateien gewechselt werden: verwende dazu die Datiendung <em>.mjs</em> (benötigt node ≥ 13)</p>
<h2>Importieren von Modulen</h2>
<p>Aufgabe: Schreibe ein node-Script, das die alte Syntax benutzt, migriere es dann zur neuen Syntax</p>
<h1>Lokale Module</h1>
<h2>Lokale Module</h2>
<p>Eine JavaScript-Datei, die Objekte exportiert, ist ein sogenanntes <em>Modul</em></p>
<h2>Lokale Module</h2>
<p>Beispiel für ein Modul mit moderner Syntax:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> message1 = <span class="hljs-string">'hello!'</span>;
<span class="hljs-keyword">const</span> message2 = <span class="hljs-string">'have a nice day!'</span>;

<span class="hljs-keyword">export</span> { message1, message2 };
</code></pre>
<h2>Lokale Module</h2>
<p>es kann einen default Export geben</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> mainMessage = <span class="hljs-string">'xyz'</span>;

<span class="hljs-keyword">const</span> message1 = <span class="hljs-string">'hello!'</span>;
<span class="hljs-keyword">const</span> message2 = <span class="hljs-string">'have a nice day!'</span>;

<span class="hljs-keyword">export</span> { message1, message2 };
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> mainMessage;
</code></pre>
<h2>Lokale Module</h2>
<p>Lokale Module werden mittels relativer Dateipfade importiert</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> mainMessage, { message1 } <span class="hljs-keyword">from</span> <span class="hljs-string">'./messages.js'</span>;
</code></pre>
<p>Dateiendung ist optional:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> mainMessage, { message1 } <span class="hljs-keyword">from</span> <span class="hljs-string">'./messages'</span>;
</code></pre>
<h2>Lokale Module</h2>
<p>ältere Syntax für den Export:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> message1 = <span class="hljs-string">'hello!'</span>;
<span class="hljs-keyword">const</span> message2 = <span class="hljs-string">'have a nice day!'</span>;

<span class="hljs-built_in">module</span>.exports.message1 = message1;
<span class="hljs-built_in">module</span>.exports.message2 = message2;
<span class="hljs-comment">// shorthand</span>
<span class="hljs-built_in">exports</span>.message3 = <span class="hljs-string">'Bye'</span>;
</code></pre>
<p>default Export:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> mainMessage = <span class="hljs-string">'xyz'</span>;

<span class="hljs-built_in">module</span>.exports = mainMessage;
</code></pre>
<h1>Globals und eingebaute Module</h1>
<h2>Globals</h2>
<p>etwas andere globale Objekte als im Browser</p>
<h2>Globals</h2>
<p>nur im Browser:</p>
<ul>
<li><code>window</code> (globaler Namespace) - Alternativname <code>globalThis</code></li>
<li><code>fetch</code></li>
<li><code>localStorage</code>, <code>sessionStorage</code></li>
</ul>
<p>nur in Node</p>
<ul>
<li><code>global</code> (globaler Namespace) - Alternativname <code>globalThis</code></li>
<li><code>process</code> (z.B. <code>process.argv</code>)</li>
<li><code>__filename</code> und <code>__dirname</code></li>
</ul>
<h2>Eingabaute Module (built-in)</h2>
<ul>
<li>assert</li>
<li>fs (file system)</li>
<li>http(s)</li>
<li>net (TCP)</li>
<li>os</li>
<li>path</li>
<li>...</li>
</ul>
<h2>Reading command line arguments</h2>
<p>command line arguments are available via the global <code>process.argv</code></p>
<p>example:</p>
<pre><code class="hljs language-bash">node program.js 1 2 3
</code></pre>
<p>will result in</p>
<pre><code class="hljs language-json">[<span class="hljs-string">"node"</span>, <span class="hljs-string">"/path/to/your/program.js"</span>, <span class="hljs-string">"1"</span>, <span class="hljs-string">"2"</span>, <span class="hljs-string">"3"</span>];
</code></pre>
<h2>Exercise</h2>
<p>Implement a program that would work like this:</p>
<pre><code class="hljs language-bash">node sum.js 1 2 3

the sum is 6
</code></pre>
<h1>Process</h1>
<h2>Process</h2>
<p><code>process</code> ist eine globale Variable</p>
<ul>
<li><code>process.argv</code> (Kommandozeilenparameter)</li>
<li><code>process.cwd()</code></li>
<li><code>process.exit()</code></li>
<li>... (siehe <a href="https://nodejs.org/dist/latest-v15.x/docs/api/process.html">https://nodejs.org/dist/latest-v15.x/docs/api/process.html</a>)</li>
</ul>
<h2>Process</h2>
<p>Übung: schreibe ein Programm, das wie folgt aufgerufen werden kann:</p>
<pre><code class="hljs language-bash">node sum.js 1 2 3

the sum is 6
</code></pre>
<h1>Lesen und Schreiben von Textdateien</h1>
<h2>Lesen und Schreiben von Dateien</h2>
<p>mittels des <em>fs</em>-Moduls:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;
</code></pre>
<h2>Schreiben von Textdateien</h2>
<pre><code class="hljs language-js">fs.writeFileSync(<span class="hljs-string">'message.txt'</span>, <span class="hljs-string">'hello world'</span>);
</code></pre>
<p>dies erstellt eine Textdatei mit UTF-8 als Encoding</p>
<h2>Lesen von Textdateien</h2>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> fileContent = fs.readFileSync(<span class="hljs-string">'package.json'</span>, <span class="hljs-string">'utf8'</span>);
</code></pre>
<p>Beim Lesen von Textdateien <em>muss</em> ein Encoding angegeben werden (in diesem Fall UTF-8)</p>
<h2>Lesen von Dateien als binär</h2>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> myFile = fs.readFileSync(<span class="hljs-string">'./package.json'</span>);
</code></pre>
<p>gibt ein <em>buffer</em>-objekt zurück (eie Folge von Bytes)</p>
<p>Umwandeln in einen String:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> fileTextContent = myFile.toString(<span class="hljs-string">'utf-8'</span>);
</code></pre>
<h2>Asynchrones I/O</h2>
<p>Lesen einer Datei kann (relativ) lange dauern. Mit dem bisherigen Code kann node währenddessen keinen Code ausführen.</p>
<h2>Asynchrones I/O mit Promises</h2>
<pre><code class="hljs language-js">fs.promises
  .readFile(<span class="hljs-string">'read-file.js'</span>, <span class="hljs-string">'utf8'</span>)
  .then(<span class="hljs-built_in">console</span>.log)
  .catch(<span class="hljs-function">() =></span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'error while reading file'</span>);
  });
</code></pre>
<h2>Asynchronous I/O mit async / await</h2>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> readFileAsync = <span class="hljs-keyword">async</span> () => {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> fileContent = <span class="hljs-keyword">await</span> fs.promises.readFile(
      <span class="hljs-string">'read-file.js'</span>,
      <span class="hljs-string">'utf8'</span>
    );
  } <span class="hljs-keyword">catch</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'error while reading file'</span>);
  }
  <span class="hljs-built_in">console</span>.log(fileContent);
};

readFileAsync();
</code></pre>
<h2>Übungen</h2>
<p>Erstelle einen HTML-"Serienbrief" für verschidene Empfänger aus einer Vorlage</p>
<p>liste alle Dateien eines bestimmten Typs auf (siehe Übung von learnyounode)</p>
<h1>HTTP client</h1>
<h2>Abfragen einer Website</h2>
<p>"low-level" (einzelne TCP-Pakete):</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> http <span class="hljs-keyword">from</span> <span class="hljs-string">'http'</span>;

http.get(<span class="hljs-string">'http://www.google.com'</span>, <span class="hljs-function">(<span class="hljs-params">responseStream</span>) =></span> {
  responseStream.setEncoding(<span class="hljs-string">'latin1'</span>);
  responseStream.on(<span class="hljs-string">'data'</span>, <span class="hljs-built_in">console</span>.log);
  responseStream.on(<span class="hljs-string">'error'</span>, <span class="hljs-built_in">console</span>.error);
});
</code></pre>
<h2>Übung</h2>
<p>Übung: rufe die Google-Website ab und schreibe Stücke davon in eine JSON-Array</p>
<h2>Libraries</h2>
<p>Libraries für HTTP-Aufrufe:</p>
<ul>
<li>Fetch-Libraries (<em>node-fetch</em>, <em>isomorphic-fetch</em>)</li>
<li>axios</li>
</ul>
<h2>Node-fetch</h2>
<pre><code class="hljs language-bash">npm install node-fetch
</code></pre>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> fetch <span class="hljs-keyword">from</span> <span class="hljs-string">'node-fetch'</span>;

fetch(<span class="hljs-string">'https://google.com'</span>)
  .then(<span class="hljs-function">(<span class="hljs-params">res</span>) =></span> res.text())
  .then(<span class="hljs-function">(<span class="hljs-params">content</span>) =></span> <span class="hljs-built_in">console</span>.log(content));
</code></pre>
<h2>Übungen</h2>
<ul>
<li>rufe mehrere Websites ab (siehe <em>learnyounode</em>: juggling async)</li>
<li>Anzahl der Goggle-Suchresultate für ein bestimmtes Thema</li>
</ul>
<h1>HTTP server</h1>
<h2>Betreiben eines HTTP-Servers mit node</h2>
<p>siehe <a href="https://nodejs.org/en/docs/guides/getting-started-guide/">https://nodejs.org/en/docs/guides/getting-started-guide/</a></p>
<h2>Betreiben eines HTTP-Servers mit node</h2>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> http <span class="hljs-keyword">from</span> <span class="hljs-string">'http'</span>;

<span class="hljs-keyword">const</span> hostname = <span class="hljs-string">'127.0.0.1'</span>;
<span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span>;

<span class="hljs-keyword">const</span> requestHandler = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =></span> {
  res.statusCode = <span class="hljs-number">200</span>;
  res.setHeader(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'text/plain'</span>);
  res.end(<span class="hljs-string">'Hello World\n'</span>);
};

server = http.createServer(requestHandler);

server.listen(port, hostname);
</code></pre>
<h2>HTTP server frameworks</h2>
<ul>
<li>connect: Middleware</li>
<li>express: Middleware, Routing</li>
</ul>
<h1>Veröffentlichen von npm Paketen</h1>
<h2>Veröffentlichen von npm Paketen</h2>
<ul>
<li>Anlegen eines Accounts auf <em>npmjs.com</em></li>
<li>Anlegen einer <em>package.json</em> Datei</li>
<li>Anlegen einer <em>.gitignore</em> oder <em>.npmignore</em> Datei</li>
<li>Ausführen von <code>npm publish --access public</code></li>
</ul>
<h2>package.json - grundlegende Einträge</h2>
<ul>
<li><em>name</em>: entweder <em>mypackage</em> (wenn noch verfügbar) oder <em>@myusername/mypackage</em></li>
<li><em>description</em></li>
<li><em>version</em>: z.B. <em>0.1.0</em></li>
<li><em>author</em>: Name des Autors</li>
<li><em>license</em>: z.B. <em>UNLICENSED</em>, <em>ISC</em>, <em>GPL-3.0</em>, ...</li>
</ul>
<h2>package.json - weitere Einträge</h2>
<ul>
<li><em>main</em>: z.B. <em>index.js</em> - der Einstiegspunkt beim Importieren dieses Pakets</li>
<li><em>scripts</em>: Befehle, die via <em>npm run</em> ausgeführt werden können (z.B. <em>build</em>, <em>test</em>, <em>start</em>, ...)</li>
<li><em>bin</em>: Befehle, die aus dem Terminal oder via npx ausgeführt werden können</li>
<li><em>dependencies</em>: npm Pakete, die zur Verwendung dieses Pakets benötigt werden</li>
<li><em>devDependencies</em>: npm Pakete, die benötigt werden, um dieses Paket weiterzuentwickeln (z.B. Testtools, Buildtools)</li>
</ul>
<h2>package.json Einträge</h2>
<p>Siehe <a href="https://docs.npmjs.com/files/package.json">https://docs.npmjs.com/files/package.json</a></p>
<h2>Dateien ignorieren</h2>
<p>Erstelle eine <code>.gitignore</code> oder <code>.npmignore</code> Datei, die Dateien auflistet, die nicht veröffentlicht werden sollen:</p>
<pre><code class="hljs language-css"><span class="hljs-selector-class">.git</span>
<span class="hljs-selector-tag">node_modules</span>
<span class="hljs-selector-tag">package-lock</span><span class="hljs-selector-class">.json</span>
</code></pre>
<h2>Veröffentlichen</h2>
<pre><code class="hljs language-bash">npm publish --access public
</code></pre>
<h2>npx Scripts</h2>
<p>Eintrag "bin" in <code>package.json</code> (sollte mit Paketnamen - ohne eventuellen Benutzernamen - übereinstimmen):</p>
<pre><code class="hljs language-json">{
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"@user/foo-package"</span>,
  <span class="hljs-attr">"bin"</span>: {
    <span class="hljs-attr">"foo-package"</span>: <span class="hljs-string">"./foo-bin.js"</span>
  }
}
</code></pre>
<p>Inhalte von <code>foo-bin.js</code>:</p>
<pre><code class="hljs language-js"><span class="hljs-meta">#! /usr/bin/env node</span>

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'this is the npx script of foo-package'</span>);
</code></pre>
<h1>Ressourcen</h1>
<h2>Ressourcen</h2>
<ul>
<li><a href="https://medium.freecodecamp.org/the-definitive-node-js-handbook-6912378afc6e">The definitive Node.js handbook by Flavio Copes</a></li>
<li><a href="https://glitch.com">Node.js web playground on glitch.com</a></li>
</ul>