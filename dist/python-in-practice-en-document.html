<h1>Python in practice</h1>
<h2>Topics</h2>
<ul>
<li>working with files and folders</li>
<li>working with various file formats</li>
<li>regular expressions</li>
<li>time and date</li>
<li>sys</li>
<li>HTTP client</li>
<li>web development</li>
<li>databases</li>
<li>Excel files</li>
<li>GUI</li>
<li>e-mail</li>
</ul>
<h1>Working with files</h1>
<h2>Working with files</h2>
<p>file = a sequence of bytes on a storage device</p>
<p>Many file formats are a sequence of text characters - e.g. the formats <em>.txt</em>, <em>.html</em>, <em>.csv</em> or <em>.py</em>.</p>
<p>The content of text files can be represented as strings, other file contents can be represented as byte sequences.</p>
<h2>Writing a text file</h2>
<pre><code class="hljs language-py">file = <span class="hljs-built_in">open</span>(<span class="hljs-string">"message.txt"</span>, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>)
file.write(<span class="hljs-string">"hello world\n"</span>)
file.write(<span class="hljs-string">"end\n"</span>)
file.close()
</code></pre>
<p>The file is opened for <em>writing</em> (<em>w</em>).</p>
<p>The character encoding will be <em>UTF-8</em>.</p>
<h2>Reading a text file</h2>
<pre><code class="hljs language-py">file = <span class="hljs-built_in">open</span>(<span class="hljs-string">"message.txt"</span>, encoding=<span class="hljs-string">"utf-8"</span>)
content = file.read()
file.close()
print(content)
</code></pre>
<p>Standard mode: <em>reading</em> (<em>r</em>)</p>
<h2>File modes</h2>
<pre><code class="hljs language-py"><span class="hljs-comment"># mode: text, append</span>
<span class="hljs-built_in">open</span>(<span class="hljs-string">"todos.txt"</span>, mode=<span class="hljs-string">"ta"</span>)
</code></pre>
<h2>File modes</h2>
<ul>
<li><code>t</code>: text mode (default)</li>
<li><code>b</code>: binary</li>
</ul>
<!-- list-separator -->
<ul>
<li><code>r</code>: reading (default)</li>
<li><code>w</code>: (over)writing</li>
<li><code>a</code>: appending</li>
</ul>
<h2>Binary files</h2>
<pre><code class="hljs language-py">wasm_content = <span class="hljs-built_in">bytes</span>([
    <span class="hljs-number">0</span>, <span class="hljs-number">97</span>, <span class="hljs-number">115</span>, <span class="hljs-number">109</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">96</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">127</span>,
    <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">7</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">97</span>, <span class="hljs-number">110</span>, <span class="hljs-number">115</span>, <span class="hljs-number">119</span>, <span class="hljs-number">101</span>, <span class="hljs-number">114</span>,
    <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">6</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-number">65</span>, <span class="hljs-number">42</span>, <span class="hljs-number">11</span>
])

file = <span class="hljs-built_in">open</span>(<span class="hljs-string">"answer.wasm"</span>, mode=<span class="hljs-string">"wb"</span>)
file.write(wasm_content)
file.close()
</code></pre>
<h2>Open and the with statement</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"todos.txt"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file_obj:
    content = file_obj.read()
</code></pre>
<p>The file will be closed automatically when the program leaves the indented block.</p>
<h2>character encoding</h2>
<p>Text files may be encoded in various ways:</p>
<ul>
<li>ASCII</li>
<li>CP-1252 / western european / latin1</li>
<li>UTF-8</li>
</ul>
<p>Recommendation: Use UTF-8 (best support for special characters)</p>
<h2>character encoding</h2>
<p>The default character encoding for text files depends on the operating system:</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> locale
locale.getpreferredencoding()
</code></pre>
<h2>File-like objects</h2>
<p>Objects that support using <code>.read()</code> or <code>.write()</code> etc:</p>
<ul>
<li>files (e.g. via <code>open()</code>)</li>
<li><code>sys.stdout</code>, <code>sys.stdin</code>
<ul>
<li>example: <code>sys.stdin.readline()</code></li>
</ul>
</li>
<li>Network replies, e.g. via <code>urllib.request.urlopen('https://google.com')</code></li>
</ul>
<h2>File-like objects</h2>
<p>Read line by line (small memory consumption):</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"myfile.txt"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> file:
        print(line)
</code></pre>
<h2>File-like objects</h2>
<p>Methods / Attributes:</p>
<ul>
<li><code>.close()</code></li>
<li><code>.mode</code></li>
<li><code>.read()</code> (read the entire file)</li>
<li><code>.read(10)</code> (read the next 10 bytes)</li>
<li><code>.readline()</code> (read the next line)</li>
</ul>
<h2>Exercise</h2>
<p>Create a program that asks the user for entries on a shopping list and stores them in a text file</p>
<h1>Working with various file formats</h1>
<h2>Working with file formats</h2>
<p>possibilities:</p>
<ul>
<li>text files</li>
<li>JSON</li>
<li>CSV</li>
<li>XML</li>
<li>Python object files (via pickle and shelve)</li>
<li>binary files</li>
</ul>
<h2>JSON</h2>
<p>JSON: popular and standardized data file format</p>
<p>can represent the fundamental Python datatypes (none, bool, int, float, list, dict)</p>
<h2>Saving JSON</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> json

data = [<span class="hljs-string">"one"</span>, <span class="hljs-string">"two"</span>, <span class="hljs-string">"three"</span>]
jsonstring = json.dumps(data)

<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"numbers.json"</span>, mode=<span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> jsonfile:
    jsonfile.write(jsonstring)
</code></pre>
<h2>Reading JSON</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> json

<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"numbers.json"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> jsonfile:
    jsonstring = jsonfile.read()
data = json.loads(jsonstring)
</code></pre>
<h2>CSV</h2>
<p>CSV is a file format which can hold tabular data; entries are separated by commas</p>
<p>example:</p>
<pre><code class="hljs language-csv">ISO,Country,Capital,Languages
AD,Andorra,Andorra la Vella,"ES,FR"
AE,United Arab Emirates,Abu Dhabi,"AE,fa,en,hi,ur"
AF,Afghanistan,Kabul,"AF,tk"
</code></pre>
<h2>CSV</h2>
<p>Python libraries:</p>
<ul>
<li><em>csv</em> (part of the standard libary)</li>
<li><em>pandas</em></li>
</ul>
<h2>Writing CSV via pandas</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd

data = pd.DataFrame(
    [
        [<span class="hljs-string">"CN"</span>, <span class="hljs-number">9.6</span>, <span class="hljs-number">1386</span>],
        [<span class="hljs-string">"RU"</span>, <span class="hljs-number">17.0</span>, <span class="hljs-number">144</span>],
        [<span class="hljs-string">"US"</span>, <span class="hljs-number">9.8</span>, <span class="hljs-number">327</span>],
    ],
    columns=[<span class="hljs-string">"code"</span>, <span class="hljs-string">"area"</span>, <span class="hljs-string">"population"</span>],
)

data.to_csv(<span class="hljs-string">"countries.csv"</span>)
</code></pre>
<h2>Reading CSV via pandas</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd

data = pd.read_csv(<span class="hljs-string">"countries.csv"</span>)

print(data)
print(data.values.tolist())
</code></pre>
<h2>Reading and writing CSV</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> csv

data = [
    [<span class="hljs-string">'code'</span>, <span class="hljs-string">'area'</span>, <span class="hljs-string">'population'</span>],
    [<span class="hljs-string">'CN'</span>, <span class="hljs-number">9.6</span>, <span class="hljs-number">1386</span>],
    [<span class="hljs-string">'RU'</span>, <span class="hljs-number">17</span>, <span class="hljs-number">144</span>],
    [<span class="hljs-string">'US'</span>, <span class="hljs-number">9.8</span>, <span class="hljs-number">327</span>]
]

<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'countr.csv'</span>, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>, newline=<span class="hljs-string">''</span>) <span class="hljs-keyword">as</span> f:
    writer = csv.writer(f)
    writer.writerows(data)

<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'countr.csv'</span>, encoding=<span class="hljs-string">'utf-8'</span>, newline=<span class="hljs-string">''</span>) <span class="hljs-keyword">as</span> f:
    reader = csv.reader(f)
    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> reader:
        print(row)
</code></pre>
<h2>XML</h2>
<p>two packages in the standard library:</p>
<ul>
<li><code>xml.etree.ElementTree</code></li>
<li><code>xml.dom.minidom</code></li>
</ul>
<p>external library (extension of ElementTree):</p>
<ul>
<li><code>lxml</code></li>
</ul>
<h2>XML with ElementTree: creating a document</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> xml.etree.ElementTree <span class="hljs-keyword">as</span> et

person = et.Element(<span class="hljs-string">'person'</span>)
name = et.SubElement(person, <span class="hljs-string">'name'</span>)
name.text = <span class="hljs-string">'Adam'</span>
age = et.SubElement(person, <span class="hljs-string">'age'</span>)
age.text = <span class="hljs-string">'40'</span>
age.<span class="hljs-built_in">set</span>(<span class="hljs-string">"unit"</span>, <span class="hljs-string">"years"</span>)
</code></pre>
<h2>XML with ElementTree: saving</h2>
<p>Always specify an encoding when saving XML!</p>
<pre><code class="hljs language-py">xmlbytestring: <span class="hljs-built_in">bytes</span> = et.tostring(person, encoding=<span class="hljs-string">'utf-8'</span>)
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"myfile.xml"</span>, mode=<span class="hljs-string">"wb"</span>) <span class="hljs-keyword">as</span> file:
    file.write(xmlbytestring)

<span class="hljs-comment"># or</span>
xmlstring: <span class="hljs-built_in">str</span> = et.tostring(person, encoding=<span class="hljs-string">'unicode'</span>)
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"myfile.xml"</span>, encoding=<span class="hljs-string">"utf-8"</span>, mode=<span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> file:
    file.write(xmlstring)

<span class="hljs-comment"># or</span>
tree = et.ElementTree(person)
tree.write(<span class="hljs-string">"myfile.xml"</span>, encoding=<span class="hljs-string">"utf-8"</span>)
</code></pre>
<h2>XML with ElementTree: reading</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> xml.etree.ElementTree <span class="hljs-keyword">as</span> et

person = et.fromstring(xmlstring)
<span class="hljs-keyword">for</span> childnode <span class="hljs-keyword">in</span> person:
    print(childnode.tag)
    print(childnode.text)
    print(childnode.attrib)
</code></pre>
<h2>Pickle</h2>
<p>File format that can be used to save various types of Python objects</p>
<p>Warning:</p>
<ul>
<li>Pickle files can only be read by Python Programs</li>
<li>Pickle files may contain malicious code</li>
</ul>
<h2>Pickle</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> pickle
<span class="hljs-keyword">import</span> datetime

now = datetime.datetime.now()

serialized = pickle.dumps(now)

<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"datetime.pickle"</span>, mode=<span class="hljs-string">"wb"</span>) <span class="hljs-keyword">as</span> picklefile:
    picklefile.write(serialized)
</code></pre>
<h2>Pickle</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> pickle

<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"datetime.pickle"</span>, mode=<span class="hljs-string">"rb"</span>) <span class="hljs-keyword">as</span> picklefile:
    serialized = picklefile.read()
earlier = pickle.loads(serialized)
</code></pre>
<h2>Exercise</h2>
<ul>
<li>saving / loading of a shopping list (optionally with amounts) in various formats</li>
<li>saving / loading of a tic-tac-toe board in various formats</li>
</ul>
<p>Python data structure for the tic-tac-toe board:</p>
<pre><code class="hljs language-py">field = [
  [<span class="hljs-string">'X'</span>, <span class="hljs-string">'O'</span>, <span class="hljs-literal">None</span>],
  [<span class="hljs-string">'X'</span>, <span class="hljs-string">'X'</span>, <span class="hljs-string">'O'</span>],
  [<span class="hljs-string">'O'</span>, <span class="hljs-string">'O'</span>, <span class="hljs-string">'X'</span>]
]
</code></pre>
<h1>Working with files and folders</h1>
<h2>Working with files and folders</h2>
<p>important packages:</p>
<ul>
<li><em>os</em></li>
<li><em>os.path</em></li>
<li><em>shutil</em></li>
</ul>
<h2>os and shutil (1)</h2>
<ul>
<li><code>os.getcwd()</code> (current path)</li>
<li><code>os.chdir()</code></li>
<li><code>os.listdir()</code></li>
</ul>
<!-- list separator -->
<ul>
<li><code>os.walk()</code></li>
</ul>
<h2>os and shutil (2)</h2>
<ul>
<li><code>os.mkdir("foo")</code></li>
<li><code>os.mkdir("foo/bar/baz")</code></li>
</ul>
<!-- list separator -->
<ul>
<li><code>os.remove("foo.txt")</code> (delete file)</li>
<li><code>os.rmdir("foo/bar/baz")</code> (delete empty folder)</li>
<li><code>shutil.rmtree()</code> (delete folder)</li>
</ul>
<!-- list separator -->
<ul>
<li><code>os.rename("foo.txt", "bar.txt")</code></li>
<li><code>shutil.move()</code> (move file or folder)</li>
<li><code>shutil.copy("foo.txt", "bar")</code> (copy file)</li>
<li><code>shutil.copytree()</code> (copy folder)</li>
</ul>
<h2>Extra: general terminal commands</h2>
<p>Direct output via <code>os.system</code>:</p>
<pre><code class="hljs language-py">os.system(<span class="hljs-string">"ls ."</span>)
os.system(<span class="hljs-string">"mkdir foo"</span>)
</code></pre>
<p>Read results in Python via <code>os.popen</code>:</p>
<pre><code class="hljs language-py">a = os.popen(<span class="hljs-string">"ls ."</span>).read()
print(a)
</code></pre>
<h2>Exercise</h2>
<p>create a program that searches for occurrences of a term in all files from a folder and prints their number</p>
<h1>Regular expressions</h1>
<h2>Regular expressions</h2>
<p>Mini language that can define a search pattern for text</p>
<p>Examples of simple search patterns:</p>
<ul>
<li>a .com domain: <code>https?://.+?\.com</code></li>
<li>an HTML heading: <code>&#x3C;h1>.+?&#x3C;/h1></code></li>
<li>a time: <code>\d?\d:\d\d</code></li>
</ul>
<h2>Try it out</h2>
<p>Online: <a href="https://regexr.com/">https://regexr.com/</a></p>
<p>In VS Code: Ctrl+F and click the button labeled <em>.*</em></p>
<h2>Special characters and escapes</h2>
<p>The following characters have special meanings:</p>
<ul>
<li><code>\</code></li>
<li><code>^</code></li>
<li><code>$</code></li>
<li><code>.</code></li>
<li><code>|</code></li>
<li><code>?</code></li>
<li><code>*</code></li>
<li><code>+</code></li>
<li><code>()</code></li>
<li><code>[]</code></li>
<li><code>{}</code></li>
</ul>
<h2>Special characters and escapes</h2>
<p>Avoid the special meaning by prepending a backslash:</p>
<ul>
<li><code>13\$</code></li>
<li><code>9\.99€</code></li>
<li><code>1\+1=2</code></li>
</ul>
<h2>Character categories</h2>
<ul>
<li><code>.</code> : any character except newline</li>
<li><code>\s</code> : whitespace</li>
<li><code>\d</code> : digit</li>
<li><code>\w</code> : digit, letter or underscore</li>
</ul>
<p>Exercise: find all digits in a document</p>
<h2>Repetitions</h2>
<ul>
<li><code>a*</code> : character <em>a</em> repeated 0 or more times (matches <em>longest</em> string)</li>
<li><code>a*?</code> : character <em>a</em> repeated 0 or more times (matches <em>shortest</em> string)</li>
<li><code>a+</code> : character <em>a</em> repeated 1 or more times (matches <em>longest</em> string)</li>
<li><code>a+?</code> : charcter <em>a</em> repeated 1 or more times (matches <em>shortest</em> string)</li>
<li><code>a?</code> : optional character <em>a</em></li>
</ul>
<p>Exercises:</p>
<ul>
<li>find all numbers, e.g. <em>12</em> or <em>0.99</em></li>
<li>find all text within quotation marks in a document</li>
<li>find all "words" that end in <code>.jpeg</code> or <code>.jpg</code></li>
</ul>
<h2>Groups</h2>
<p>Group expressions via <code>(...)</code></p>
<p>Examples:</p>
<ul>
<li><code>(ab)+</code> matches repetitions of the sequence <em>ab</em></li>
<li><code>&#x3C;(-=)+-></code> matches the following pattern: <code>&#x3C;-=-=-=-=-></code></li>
</ul>
<h2>Alternatives</h2>
<p><code>...|...|...</code> : Match any of the listed alternatives</p>
<p>Example to find an image: <code>\.(jpe?g|png|gif)</code></p>
<p>Exercises:</p>
<ul>
<li>find URLs that start with <code>http://</code> or <code>https://</code> and end with <code>.com</code> or <code>.org</code></li>
</ul>
<h2>Capture groups</h2>
<p>Groups can be used to extract information</p>
<p>Example: <code>(\d?\d):(\d\d)</code> will extract two values</p>
<h2>Start &#x26; end</h2>
<ul>
<li><code>\A</code> : start of the string</li>
<li><code>\Z</code> : end of the string</li>
<li><code>^</code> : start of a line</li>
<li><code>$</code> : end of a line</li>
</ul>
<h2>Character classes</h2>
<ul>
<li><code>[a-z]</code> : any lowercase ASCII letter</li>
<li><code>[a-zA-Z]</code> : any ASCII letter</li>
<li><code>[,;.]</code> : same as <code>(,|;|.)</code></li>
</ul>
<h1>Regular expressions in Python</h1>
<h2>Regular expressions</h2>
<p>Regular expressions are used to find a substring of a specific pattern inside a string</p>
<p>in Python regular expressions can be handled via the <code>re</code> Package, in particular:</p>
<ul>
<li><code>re.search</code></li>
<li><code>re.finditer</code></li>
</ul>
<h2>Regular expressions</h2>
<p>example:</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> re

match = re.search(<span class="hljs-string">r"[a-z][A-Z]"</span>, <span class="hljs-string">"abCdE"</span>)

<span class="hljs-keyword">if</span> match:
    print(<span class="hljs-string">"match"</span>)
    print(match[<span class="hljs-number">0</span>]) <span class="hljs-comment"># bC</span>
<span class="hljs-keyword">else</span>:
    print(<span class="hljs-string">"no match"</span>)
</code></pre>
<h2>Finding multiple occurrences</h2>
<p>example:</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> re

match_iter = re.finditer(<span class="hljs-string">r"https?://.+?\.com"</span>, website_content)

<span class="hljs-keyword">for</span> match <span class="hljs-keyword">in</span> match_iter:
    print(match[<span class="hljs-number">0</span>])
</code></pre>
<h2>Finding multiple occurrences</h2>
<p>Exercise: find all URLs in a HTML document on the drive</p>
<p>For an example, save the page <a href="https://news.ycombinator.com">https://news.ycombinator.com</a> to disk</p>
<h2>Finding an expression and sub expressions</h2>
<pre><code class="hljs language-py">times = re.finditer(
    <span class="hljs-string">r'(\d?\d):(\d\d)'</span>,
    <span class="hljs-string">'The course times are 9:30 - 16:30'</span>
)

<span class="hljs-keyword">for</span> time <span class="hljs-keyword">in</span> times:
    print(<span class="hljs-string">f"hour: <span class="hljs-subst">{time[<span class="hljs-number">1</span>]}</span>"</span>)
    print(<span class="hljs-string">f"minute: <span class="hljs-subst">{time[<span class="hljs-number">2</span>]}</span>"</span>)
</code></pre>
<h2>Compiling regular expressions</h2>
<p>Optimizing performance if expressions are reused:</p>
<pre><code class="hljs language-py">my_re = <span class="hljs-string">"..."</span>

re.search(my_re, ...)
re.finditer(my_re, ...)
</code></pre>
<p>becomes</p>
<pre><code class="hljs language-py">my_re = <span class="hljs-string">"..."</span>
my_re_obj = re.<span class="hljs-built_in">compile</span>(my_re)

my_re_obj.search(...)
my_re_obj.finditer(...)
</code></pre>
<h2>Exercises</h2>
<ul>
<li>find function definitions in a Python file</li>
<li>find and parse monetary amounts in a text</li>
<li>find and parse equations in text</li>
</ul>
<h2>Resources</h2>
<ul>
<li><a href="http://automatetheboringstuff.com/chapter7/">http://automatetheboringstuff.com/chapter7/</a></li>
</ul>
<h1>Date and time</h1>
<h2>Date and time</h2>
<p>Python packages:</p>
<ul>
<li><strong>datetime</strong>: working with times and dates</li>
<li><strong>time</strong>: working with Unix timestamps, sleep</li>
</ul>
<h2>datetime</h2>
<ul>
<li><code>datetime.date</code></li>
<li><code>datetime.time</code></li>
<li><code>datetime.datetime</code></li>
</ul>
<h2>datetime</h2>
<pre><code class="hljs language-py">a = datetime.time(hour, minute, second, microsecond)
</code></pre>
<pre><code class="hljs language-py">b = datetime.datetime(<span class="hljs-number">2018</span>, <span class="hljs-number">1</span>, <span class="hljs-number">13</span>)
c = datetime.datetime(<span class="hljs-number">2018</span>, <span class="hljs-number">3</span>, <span class="hljs-number">26</span>, <span class="hljs-number">12</span>, <span class="hljs-number">30</span>)

c - b
</code></pre>
<h2>time.sleep</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):
    print(i)
    time.sleep(<span class="hljs-number">1</span>)
</code></pre>
<h2>time.time</h2>
<p>current Unix time (seconds since 1970-01-01 00:00:00 UTC)</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> time
time.time()
</code></pre>
<h1>sys</h1>
<h2>sys</h2>
<p>Functions for the Python environment</p>
<p>examples:</p>
<ul>
<li><code>argv</code></li>
<li><code>stdout.write</code></li>
<li><code>getrefcount</code></li>
<li><code>path</code></li>
<li><code>version</code></li>
<li><code>version_info</code></li>
</ul>
<h2>Command line parameters</h2>
<p>may be read via <code>sys.argv</code></p>
<pre><code class="hljs language-py"><span class="hljs-comment"># hello.py</span>
<span class="hljs-keyword">import</span> sys
print(sys.argv)
</code></pre>
<pre><code class="hljs language-bash">python hello.py one two three
</code></pre>
<pre><code class="hljs language-python">[<span class="hljs-string">'hello.py'</span>, <span class="hljs-string">'--run'</span>, <span class="hljs-string">'--file=foo.txt'</span>]
</code></pre>
<h2>Overwriting stdout.write</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> sys

old_stdout = sys.stdout

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoudStdout</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write</span>(<span class="hljs-params">self, text</span>):</span>
        old_stdout.write(text.upper())

loudstdout = LoudStdout()

sys.stdout = loudstdout
</code></pre>
<h1>HTTP with Python</h1>
<h2>HTTP with Python</h2>
<ul>
<li>http.client.HTTP(S)Connection</li>
<li>urllib</li>
<li>requests</li>
</ul>
<h2>HTTP via TCP</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> socket

client = socket.socket()
client.connect((<span class="hljs-string">"google.com"</span>, <span class="hljs-number">80</span>))
client.send(<span class="hljs-string">b"GET / HTTP/1.1\r\nHost: www.google.com\r\n\r\n"</span>)

response = client.recv(<span class="hljs-number">4096</span>)
print(response)
</code></pre>
<p>Exercise: script that reads and processes a file named <code>request.httpreq</code> and creates a file named <code>response.httpres</code></p>
<h2>HTTP(S)Connection</h2>
<p>low level HTTP interface</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">from</span> http.client <span class="hljs-keyword">import</span> HTTPSConnection

connection = HTTPSConnection(<span class="hljs-string">"www.google.com"</span>)
connection.request(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"/"</span>)
answer = connection.getresponse()
content = answer.read()
connection.close()
print(content)
</code></pre>
<h2>urllib</h2>
<p>part of the standard library</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> request

content: <span class="hljs-built_in">bytes</span> = request.urlopen(
                    <span class="hljs-string">"https://www.google.com"</span>).read()
</code></pre>
<h2>requests</h2>
<p>external package that may be installed via <em>pip</em>:</p>
<pre><code class="hljs language-bash">pip install requests
</code></pre>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> requests

content: <span class="hljs-built_in">str</span> = requests.get(<span class="hljs-string">"https://www.google.com"</span>).text
</code></pre>
<h2>Exercises</h2>
<ul>
<li>web scraping: number of Google search results</li>
<li>web scraping: headings in a Wikipedia article</li>
<li>APIs: weather data
<a href="https://automatetheboringstuff.com/chapter14/">https://automatetheboringstuff.com/chapter14/</a></li>
<li>web scraping: xkcd downloader
<a href="https://automatetheboringstuff.com/chapter11/">https://automatetheboringstuff.com/chapter11/</a></li>
</ul>
<h2>Selenium</h2>
<p>Installation:</p>
<pre><code class="hljs language-bash">pip install selenium
</code></pre>
<p>geckodriver / chromedriver / ...</p>
<p>download geckodriver from:</p>
<p><a href="https://github.com/mozilla/geckodriver/releases/tag/v0.23.0">https://github.com/mozilla/geckodriver/releases/tag/v0.23.0</a></p>
<p>Download and save in a folder in Python's <code>sys.path</code> - or in the project directory</p>
<h1>HTTP</h1>
<h2>HTTP</h2>
<p>See <a href="./http-en.html">presentation on HTTP</a></p>
<h1>Server-side HTTP</h1>
<h2>Operating a local file server with Python</h2>
<pre><code class="hljs language-bash">python -m http.server
</code></pre>
<h2>Overview</h2>
<p><a href="https://docs.python.org/2/howto/webservers.html">https://docs.python.org/2/howto/webservers.html</a></p>
<p>(info is somewhat dated)</p>
<h2>CGI, WSGI and ASGI</h2>
<p>= standard interfaces for letting a program on a server reply to an HTTP request</p>
<ul>
<li><em>CGI</em>: cross-language standard, slow performance</li>
<li><em>WSGI</em>: adaptation of CGI for Python</li>
<li><em>ASGI</em>: asynchronous version of WSGI</li>
</ul>
<h2>CGI</h2>
<p>CGI (<em>Common Gateway Interface</em>): Interface between server software (e.g. Apache) and a web application (written in any programming language)</p>
<p>Interface relies on <em>stdin</em>, <em>stdout</em> and environment variables</p>
<p>Drawback: a new Process has to be started for every request (which is slow)</p>
<h2>WSGI</h2>
<p>WSGI = Web Server Gateway Interface</p>
<p>Standard for letting a Python program on a server reply to an HTTP request</p>
<p>Inspired by CGI; advantage: <em>one</em> running Process can handle multiple request one after another</p>
<h2>Python web frameworks</h2>
<ul>
<li>Werkzeug (Python WSGI utility library)</li>
<li>Flask (fully fledged, modular framework based on Werkzeug)</li>
<li>Django (full framework)</li>
</ul>
<h2>WSGI interface</h2>
<p>The entry point is a Python function:</p>
<p>The function will receive two parameters: <code>environ</code> and <code>start_response</code></p>
<p>The request parameters are available via <code>environ</code> (e.g. URL, HTTP headers, form data, ...)</p>
<p>The second parameter is a function which we usually name <code>start_response</code>.</p>
<h2>WSGI</h2>
<p>In order to start a response we call <code>start_response(status, response_headers)</code>, e.g.:</p>
<pre><code class="hljs language-py">start_response(
    <span class="hljs-string">"200 OK"</span>,
    [(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"text/plain; charset=utf-8"</span>)]
)
</code></pre>
<p>The response body is an iterable (e.g. a list) of bytestrings.</p>
<h2>WSGI server software</h2>
<p>server software:</p>
<ul>
<li>gunicorn</li>
<li>uWSGI</li>
<li>mod_wsgi</li>
</ul>
<h2>Custom WSGI server in Python</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">from</span> wsgiref.simple_server <span class="hljs-keyword">import</span> make_server

<span class="hljs-keyword">from</span> app <span class="hljs-keyword">import</span> application

server = make_server(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">8000</span>, application)
server.serve_forever()
</code></pre>
<p>This part will usually be handled by libraries like <em>guinicorn</em></p>
<h2>WSGI application</h2>
<pre><code class="hljs language-py"><span class="hljs-comment"># app.py</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">application</span>(<span class="hljs-params">environ, start_response</span>):</span>
    response_status = <span class="hljs-string">"200 OK"</span>
    response_body_text = <span class="hljs-string">"hello"</span>
    response_body = response_body_text.encode(<span class="hljs-string">"utf-8"</span>)
    response_headers = [
        (<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"text/plain; charset=utf-8"</span>),
        (<span class="hljs-string">"Content-Length"</span>, <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(response_body))),
    ]
    start_response(response_status, response_headers)
    <span class="hljs-keyword">return</span> [response_body]
</code></pre>
<h2>The environ dictionary</h2>
<p>We can view it in the debugger, e.g.:</p>
<pre><code class="hljs language-py">{
    <span class="hljs-string">"CONTENT_LENGTH"</span>: <span class="hljs-string">"12"</span>
    <span class="hljs-string">"HTTP_USER_AGENT"</span>: <span class="hljs-string">'Mozilla/5.0 (Win...'</span>,
    <span class="hljs-string">"HTTP_COOKIE"</span>:
    <span class="hljs-string">"PATH_INFO"</span>: <span class="hljs-string">"/todos/new"</span>,
    <span class="hljs-string">"REQUEST_METHOD"</span>: <span class="hljs-string">"GET"</span>,
    <span class="hljs-string">"wsgi.input"</span>: ...
}
</code></pre>
<p><a href="https://www.python.org/dev/peps/pep-0333/#environ-variables">https://www.python.org/dev/peps/pep-0333/#environ-variables</a></p>
<h2>PATH_INFO</h2>
<p>PATH_INFO in the environ dictionary: requested path on the server</p>
<p>task: show different pages at different addresses</p>
<h2>Redirects with HTTP</h2>
<pre><code class="hljs language-py">response_headers = [
    (<span class="hljs-string">"Location"</span>, <span class="hljs-string">"/login"</span>),
    (<span class="hljs-string">"Content-Length"</span>, <span class="hljs-string">"0"</span>)
]
start_response(<span class="hljs-string">"307 Temporary Redirect"</span>, response_headers)
<span class="hljs-keyword">return</span> [<span class="hljs-string">b''</span>]
</code></pre>
<p>Task: Make some pages redirect, e.g. make <code>/now</code> redirect to <code>/time</code></p>
<h2>Cookies</h2>
<p>Cookies = small sets of data which may be placed in the Browser by a website</p>
<p>Cookies may be used to recognize a previous visitor, e.g. for:</p>
<ul>
<li>staying logged in</li>
<li>tracking user activities</li>
<li>displaying custom ads</li>
</ul>
<h2>Setting cookies</h2>
<pre><code class="hljs language-py">response_headers.append((
    <span class="hljs-string">"Set-Cookie"</span>, <span class="hljs-string">"mycookie123=abcd; Max-Age=30"</span>
))
</code></pre>
<h2>Reading cookies</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">try</span>:
    current_cookies_str = environ[<span class="hljs-string">"HTTP_COOKIE"</span>]
<span class="hljs-keyword">except</span> KeyError:
    ...
</code></pre>
<p>result may be: <code>"cookie1=one; cookie2=two"</code></p>
<h2>Parsing cookies</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">from</span> http <span class="hljs-keyword">import</span> cookies

...

mycookies = cookies.SimpleCookie()
mycookies.load(current_cookies_str)
mycookies[<span class="hljs-string">"cookie1"</span>].value
</code></pre>
<h2>Deleting cookies</h2>
<p>by setting an expired cookie</p>
<pre><code class="hljs language-py">response_headers.append((
    <span class="hljs-string">"Set-Cookie"</span>,
    <span class="hljs-string">"mycookie123=; expires=Thu, 01 Jan 1970 00:00:00 GMT"</span>
))
</code></pre>
<h2>Cookies</h2>
<p>Task: Create a website which only lets the user visit content 5 times before requiring them to log in</p>
<h2>Forms and POST requests</h2>
<p>This is how we read parameters from forms:</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> parse_qs

request_body_size = <span class="hljs-built_in">int</span>(environ.get(<span class="hljs-string">'CONTENT_LENGTH'</span>, <span class="hljs-string">'0'</span>))
<span class="hljs-comment"># environ["wsgi.input"] is a file-like object</span>
request_body = (environ[<span class="hljs-string">"wsgi.input"</span>]
                .read(request_body_size)
                .decode(<span class="hljs-string">"utf-8"</span>))

parameters = parse_qs(request_body)
first_name = parameters.get(<span class="hljs-string">"first-name"</span>)[<span class="hljs-number">0</span>]
</code></pre>
<h2>Exercises</h2>
<ul>
<li>online voting</li>
<li>guest book</li>
<li>chat</li>
<li>todo application</li>
</ul>
<h2>Beware: JavaScript injection</h2>
<h2>Deployment on pythonanywhere.com</h2>
<ul>
<li>new user account on <a href="https://pythonanywhere.com">https://pythonanywhere.com</a></li>
<li>add new web app</li>
<li>manual configuration</li>
</ul>
<h2>Deployment on pythonanywhere.com</h2>
<p>WSGI configuration file</p>
<pre><code class="hljs language-py"><span class="hljs-comment"># /var/www/username_pythonanywhere_com_wsgi.py</span>
<span class="hljs-keyword">import</span> sys

path = <span class="hljs-string">"/home/username/"</span>
<span class="hljs-keyword">if</span> path <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> sys.path:
    sys.path.append(path)

<span class="hljs-keyword">from</span> app <span class="hljs-keyword">import</span> application
</code></pre>
<h1>HTTP API development</h1>
<h2>HTTP API development</h2>
<p>For basics see the <a href="./http-en.html#/1">presentation on HTTP</a></p>
<h2>HTTP API development</h2>
<p>tools for API development with Python:</p>
<ul>
<li>FastAPI</li>
<li>Django REST framework</li>
<li>flask-restful</li>
<li>graphene (GraphQL APIs)</li>
</ul>
<h2>HTTP API development</h2>
<p>Task: develop a simple API with FastAPI that has these resouces:</p>
<ul>
<li><code>/time</code></li>
<li><code>/date</code></li>
<li><code>/randnr</code> (random number)</li>
</ul>
<h2>HTTP API development</h2>
<p>Task:</p>
<p>develop an API with FastAPI that can manage a list of todos</p>
<p>implement these endpoints:</p>
<ul>
<li><code>GET /todos</code> (JSON array of all todos)</li>
<li><code>GET /todos/$id</code> (single todo by id)</li>
<li><code>POST /todos</code> (add a todo)</li>
<li><code>DELETE /todos/$id</code> (delete a single todo)</li>
<li><code>PATCH /todos/$id</code> (modify a todo)</li>
<li><code>POST /delete_completed_todos</code></li>
</ul>
<p>The todos can be stored in a simple JSON file - or in an actual database</p>
<h1>Databases</h1>
<p>For basics see presentation <em>databases and data store</em></p>
<h1>SQL with Python</h1>
<h2>Python interfaces for SQL databases</h2>
<p>Database API specification: standard which is implemented by various Python database bindings; standardized in PEP 249</p>
<p>bindings for:</p>
<ul>
<li>sqlite (Python package <em>sqlite3</em>)</li>
<li>Postgresql (PIP package <em>psycopg2</em>)</li>
<li>MySQL / mariadb (PIP package <em>PyMySQL</em></li>
<li>Oracle (PIP package <em>cx_oracle</em>)</li>
</ul>
<h2>SQLite and Python</h2>
<p>SQLite uses one file to store a database</p>
<p>comes with Python (module <code>sqlite3</code>)</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> sqlite3

<span class="hljs-comment"># database stored in a file</span>
connection = sqlite3.connect(<span class="hljs-string">'contacts.db'</span>)

<span class="hljs-comment"># in-memory database</span>
connection = sqlite3.connect(<span class="hljs-string">':memory:'</span>)
</code></pre>
<h2>MySQL and Python</h2>
<p>PIP package <em>PyMySQL</em></p>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> pymysql.cursors

connection = pymysql.connect(host=<span class="hljs-string">'localhost'</span>,
                             user=<span class="hljs-string">'user'</span>,
                             password=<span class="hljs-string">'passwd'</span>,
                             db=<span class="hljs-string">'db'</span>,
                             charset=<span class="hljs-string">'utf8mb4'</span>)
</code></pre>
<h2>Python and Oracle Database</h2>
<p>Python package <em>cx_Oracle</em></p>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> cx_Oracle

connection = cx_Oracle.connect(user=<span class="hljs-string">"user"</span>,
                               password=<span class="hljs-string">"password"</span>,
                               dsn=<span class="hljs-string">"localhost/oraclepdb"</span>)
</code></pre>
<h2>pyodbc</h2>
<p>ODBC = open database connectivity: Standard for database interfaces (independent of Python)</p>
<p>pyodbc = implementation for Python - this enables access to any ODBC database</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> pyodbc

connection = pyodbc.connect(
  <span class="hljs-string">"Driver=SQLite3 ODBC Driver;Database=contacts.db"</span>)
</code></pre>
<h2>Common interface (PEP 249)</h2>
<pre><code class="hljs language-py">connection = ...
...
cursor = connection.cursor()
cursor.execute(<span class="hljs-string">"SELECT ..."</span>)
print(cursor.fetchall())
...
cursor = connection.cursor()
cursor.execute(<span class="hljs-string">"INSERT INTO ..."</span>)
cursor.execute(<span class="hljs-string">"INSERT INTO ..."</span>)
connection.commit()
...
connection.close()
</code></pre>
<h2>PEP 249</h2>
<p><a href="https://www.python.org/dev/peps/pep-0249">https://www.python.org/dev/peps/pep-0249</a></p>
<h2>SQL statements with parameters</h2>
<p>dangerous:</p>
<pre><code class="hljs language-py">search_name = <span class="hljs-built_in">input</span>()
res = cursor.execute(
  <span class="hljs-string">f"""SELECT tel FROM person WHERE name = '<span class="hljs-subst">{search_name}</span>'"""</span>
)
</code></pre>
<h2>SQL statements with parameters</h2>
<p>safe method (with SQL escaping):</p>
<pre><code class="hljs language-py">search_name = <span class="hljs-built_in">input</span>()
res = cursor.execute(
  <span class="hljs-string">"""SELECT tel FROM person WHERE name = ?;"""</span>,
  (search_name, )
)
</code></pre>
<h2>SQL statements with parameters</h2>
<p><a href="https://www.python.org/dev/peps/pep-0249/#paramstyle">https://www.python.org/dev/peps/pep-0249/#paramstyle</a></p>
<p>The attributes <code>sqlite3.paramstyle</code>, <code>pymysql.paramstyle</code> etc. indicate the format for queries with parameters</p>
<ul>
<li>sqlite3: qmark</li>
<li>pymysql: pyformat</li>
<li>psycopg2: pyformat</li>
<li>cx_Oracle: named</li>
</ul>
<h2>PEP 249: the cursor object</h2>
<ul>
<li><code>cursor.execute(command, parameters)</code></li>
<li><code>cursor.rowcount</code>: number of result rows in the last query</li>
<li><code>cursor.fetchone()</code>: get a single row of the result (usually as a tuple)</li>
<li><code>cursor.fetchmany(10)</code></li>
<li><code>cursor.fetchall()</code></li>
</ul>
<h2>Exercise: Forum with database binding</h2>
<ul>
<li>authentication (MD5)</li>
<li>admin script</li>
</ul>
<h2>Exercise: todo app</h2>
<p>Todo application (with web interface)
(see courses-tutorials/python-todolist-wsgi-sqlite)</p>
<h1>SQLite with Python</h1>
<h2>Data types</h2>
<p>SQLite data types and corresponding Python types:</p>
<ul>
<li><code>NULL</code> - <code>None</code></li>
<li><code>INT</code> / <code>INTEGER</code> - <code>int</code></li>
<li><code>REAL</code> - <code>float</code></li>
<li><code>TEXT</code> - <code>str</code></li>
<li><code>BLOB</code> - <code>bytes</code></li>
</ul>
<h2>Supporting dates and timestamps</h2>
<p>Two types that are usually not supported by SQLite:</p>
<ul>
<li><code>TIMESTAMP</code> - <code>datetime</code></li>
<li><code>DATE</code> - <code>date</code></li>
</ul>
<p>Storing them as SQL <em>DECIMAL</em> values with automatic conversion to / from Python types:</p>
<pre><code class="hljs language-py">connection = sqlite3.connect(
    <span class="hljs-string">'contacts.db'</span>
    detect_types=sqlite3.PARSE_DECLTYPES)
</code></pre>
<h2>Supporting dates and timestamps</h2>
<p>Task: Create a contacts database that automatically converts SQL decimals that represent the date of birth into Python <code>date</code> objects.</p>
<h2>Adapters and converters</h2>
<p>We can add support for more types by writing so-called <em>adapter</em> and <em>converter</em> functions. These custom types will usually be stored as byte sequences in the database.</p>
<p>An <em>adapter</em> is a custom function that converts a Python object into an SQL value.</p>
<p>A <em>converter</em> is a custom function that converts an SQL value into a Python object.</p>
<p>see:</p>
<p><a href="https://docs.python.org/3/library/sqlite3.html#using-adapters-to-store-additional-python-types-in-sqlite-databases">https://docs.python.org/3/library/sqlite3.html#using-adapters-to-store-additional-python-types-in-sqlite-databases</a></p>
<h2>Adapters and converters</h2>
<p>Tasks:</p>
<ul>
<li>Write an adapter and converter that enable us to directly save instances of Python's <code>ipadress.IPv4Address</code> class - in SQL it would be saved as an encoded byte string</li>
</ul>
<h1>SQLAlchemy</h1>
<!--
requirements: classes
-->
<h2>SQLAlchemy</h2>
<p>SQLAlchemy = Object Relational Mapper</p>
<p>Object oriented access to arbitrary SQL databases</p>
<p>potential alternative: Django ORM</p>
<h2>SQLAlchemy</h2>
<p>Pip package <em>sqlalchemy</em></p>
<h2>Connecting with an SQLite database</h2>
<pre><code class="hljs language-py"><span class="hljs-comment"># db_interface.py</span>
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> create_engine

engine = create_engine(<span class="hljs-string">"sqlite:///music.db"</span>, echo=<span class="hljs-literal">True</span>)

engine.connect()
</code></pre>
<h2>Defining tables</h2>
<pre><code class="hljs language-py"><span class="hljs-comment"># schema.py</span>
<span class="hljs-keyword">from</span> sqlalchemy.ext.declarative <span class="hljs-keyword">import</span> declarative_base
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> Column, Integer, String

Base = declarative_base()

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Artist</span>(<span class="hljs-params">Base</span>):</span>
    __tablename__ = <span class="hljs-string">"artist"</span>
    <span class="hljs-built_in">id</span> = Column(Integer, primary_key=<span class="hljs-literal">True</span>)
    name = Column(String(<span class="hljs-number">30</span>))
    country = Column(String(<span class="hljs-number">20</span>))
</code></pre>
<pre><code class="hljs language-py"><span class="hljs-comment"># db_interface.py</span>
Base.metadata.create_all(engine)
</code></pre>
<h2>Working with sessions</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> sessionmaker

Session = sessionmaker(bind=engine)

session = Session()

...

session.commit()
</code></pre>
<h2>Insert</h2>
<pre><code class="hljs language-sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> artist <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'The Beatles'</span>, <span class="hljs-string">'United Kingdom'</span>);
</code></pre>
<p>becomes:</p>
<pre><code class="hljs language-py">beatles = Artist(name=<span class="hljs-string">"The Beatles"</span>, country=<span class="hljs-string">"United Kingdom"</span>)
session.add(beatles)
</code></pre>
<h2>Select</h2>
<pre><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span>, country <span class="hljs-keyword">FROM</span> artist;
</code></pre>
<p>becomes:</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">for</span> artist <span class="hljs-keyword">in</span> session.query(Artist):
    print(<span class="hljs-string">f"<span class="hljs-subst">{artist.name}</span> (<span class="hljs-subst">{artist.country}</span>)"</span>)
</code></pre>
<p>or</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">for</span> name, country <span class="hljs-keyword">in</span> session.query(Artist.name, Artist.country):
    print(<span class="hljs-string">f"<span class="hljs-subst">{name}</span> (<span class="hljs-subst">{country}</span>)"</span>)
</code></pre>
<h2>Order by</h2>
<pre><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span>, country <span class="hljs-keyword">FROM</span> artist <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">name</span>;
</code></pre>
<p>becomes:</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">for</span> name, country <span class="hljs-keyword">in</span> session.query(
        Artist.name, Artist.country).order_by(Artist.name):
    ...
</code></pre>
<h2>Where</h2>
<pre><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span>, country <span class="hljs-keyword">FROM</span> artist <span class="hljs-keyword">WHERE</span> artist.name=<span class="hljs-string">'The Beatles'</span>
</code></pre>
<p>becomes:</p>
<pre><code class="hljs language-py">session.query(Artist).<span class="hljs-built_in">filter</span>(Artist.name==<span class="hljs-string">"The Beatles"</span>).one()
</code></pre>
<h2>Nicer representation of entries</h2>
<p>currently:</p>
<pre><code class="hljs language-txt">&#x26;ltdb_schema.Song object at 0x00000175902A5FD0>
</code></pre>
<p>better:</p>
<pre><code class="hljs language-txt">Help! - The Beatles
</code></pre>
<p>We can achieve this via the methods <code>__repr__</code> / <code>__str__</code></p>
<h2>Update</h2>
<pre><code class="hljs language-sql"><span class="hljs-keyword">UPDATE</span> song
<span class="hljs-keyword">SET</span> title = <span class="hljs-string">'Help'</span>
<span class="hljs-keyword">WHERE</span> title = <span class="hljs-string">'Help!'</span>;
</code></pre>
<p>becomes</p>
<pre><code class="hljs language-py">entry = session.query(Song).<span class="hljs-built_in">filter</span>(Song.title==<span class="hljs-string">"Help!"</span>).one()
entry.title = <span class="hljs-string">"Help"</span>
</code></pre>
<h2>Delete</h2>
<pre><code class="hljs language-sql"><span class="hljs-keyword">DELETE</span>
<span class="hljs-keyword">FROM</span> song
<span class="hljs-keyword">WHERE</span> title = <span class="hljs-string">'Help!'</span>;
</code></pre>
<p>becomes</p>
<pre><code class="hljs language-py">session.query(Song).<span class="hljs-built_in">filter</span>(Song.title==<span class="hljs-string">"Help!"</span>).delete()
</code></pre>
<h2>Defining a foreign key</h2>
<pre><code class="hljs language-py"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Song</span>(<span class="hljs-params">Base</span>):</span>
    __tablename__ = <span class="hljs-string">"song"</span>
    <span class="hljs-built_in">id</span> = Column(Integer, primary_key=<span class="hljs-literal">True</span>)
    title = Column(String(<span class="hljs-number">30</span>))
    artist_id = Column(Integer, ForeignKey(<span class="hljs-string">"artist.id"</span>))
</code></pre>
<h2>Querying a related table</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> relationship

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Artist</span>(<span class="hljs-params">Base</span>):</span>
    ...
    songs = relationship(<span class="hljs-string">"Song"</span>)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Song</span>(<span class="hljs-params">Base</span>):</span>
    ...
    artist_id = Column(Integer, ForeignKey(<span class="hljs-string">"artist.id"</span>))

    artist = relationship(<span class="hljs-string">"Artist"</span>)
</code></pre>
<h2>Querying a related table</h2>
<pre><code class="hljs language-py">yesterday = Song(title=<span class="hljs-string">"Yesterday"</span>, artist=beatles)
<span class="hljs-built_in">help</span> = Song(title=<span class="hljs-string">"Help!"</span>, artist_id=beatles.<span class="hljs-built_in">id</span>)
session.add(...)

print(yesterday.artist)
print(beatles.songs)
</code></pre>
<h1>Working with Excel files</h1>
<h2>Working with Excel files</h2>
<p>PIP package <em>openpyxl</em></p>
<h2>Openpyxl</h2>
<p>Creating, saving, loading:</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> openpyxl

wb = openpyxl.Workbook()
wb.save(<span class="hljs-string">"wb.xlsx"</span>)

wb2 = openpyxl.load_workbook(<span class="hljs-string">"wb.xlsx"</span>)
</code></pre>
<h2>Openpyxl</h2>
<p>Creating and getting worksheets:</p>
<pre><code class="hljs language-py">ws1 = wb.worksheets[<span class="hljs-number">0</span>]
print(wb.sheetnames) <span class="hljs-comment"># ["Sheet"]</span>
ws1 = wb[<span class="hljs-string">"Sheet"</span>]

<span class="hljs-comment"># new sheet 0</span>
wb.create_sheet(<span class="hljs-string">"Sheet2"</span>, <span class="hljs-number">0</span>)
ws2 = wb[<span class="hljs-string">"Sheet2"</span>]
</code></pre>
<h2>Openpyxl</h2>
<p>Working with worksheets:</p>
<pre><code class="hljs language-py">ws = wb.worksheets[<span class="hljs-number">0</span>]

ws.title = <span class="hljs-string">"times table"</span>
</code></pre>
<h2>Openpyxl</h2>
<p>Working with cells:</p>
<pre><code class="hljs language-py">a1 = ws.cell(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)
a1 = ws[<span class="hljs-string">"A1"</span>]

a1.value <span class="hljs-comment"># None</span>
a1.value = <span class="hljs-number">3</span>

a1.row <span class="hljs-comment"># 1</span>
a1.column <span class="hljs-comment"># 1</span>
a1.coordinate <span class="hljs-comment"># "A1"</span>
</code></pre>
<h2>Openpyxl</h2>
<p>Exercise: Create the followng table:</p>

























<table><thead><tr><th>product</th><th>price</th><th>stock</th></tr></thead><tbody><tr><td>apple</td><td>1.00</td><td>10</td></tr><tr><td>banana</td><td>0.70</td><td>20</td></tr><tr><td>pear</td><td>0.80</td><td>20</td></tr></tbody></table>
<h2>Resources</h2>
<ul>
<li><a href="https://openpyxl.readthedocs.io/en/stable/usage.html">openpyxl documentation - Simple usage</a></li>
<li><a href="https://openpyxl.readthedocs.io/en/stable/#key-classes">openpyxl documentation - Key Classes</a></li>
<li><a href="http://automatetheboringstuff.com/chapter12/">Automate the Boring Stuff with Python - Chapter 12</a></li>
</ul>
<h1>GUI (Graphical User Interface)</h1>
<h2>GUI-Libraries for Python</h2>
<ul>
<li>tk</li>
<li>Qt</li>
<li>Kivy</li>
</ul>
<h2>tk</h2>
<ul>
<li>Simple UI library</li>
<li>Python interface: tkinter</li>
<li>comes with Python on Windows</li>
</ul>
<h2>Qt</h2>
<ul>
<li>widely used UI library</li>
<li>Python interfaces: PyQt or PySide</li>
</ul>
<h2>Kivy</h2>
<ul>
<li>specifically developed for Python</li>
</ul>
<h1>Tkinter</h1>
<h2>Tkinter</h2>
<p><a href="https://tkdocs.com/">https://tkdocs.com/</a></p>
<h2>Displaying a window</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> tkinter <span class="hljs-keyword">as</span> tk

window = tk.Tk()

window.mainloop()
</code></pre>
<p>A window is created as a <code>Tk</code> object.</p>
<p>The method <code>mainloop()</code> starts the program (and waits for user interaction)</p>
<h2>Displaying text</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> tkinter <span class="hljs-keyword">as</span> tk

window = tk.Tk()

hello_label = tk.Label(master=window, text=<span class="hljs-string">"Hello!"</span>)
hello_label.pack()

window.mainloop()
</code></pre>
<h2>Modifying elements</h2>
<pre><code class="hljs language-py">hello_label = tk.Label(master=window, text=<span class="hljs-string">"Hello!"</span>)
hello_label.config(text=<span class="hljs-string">"Hi!"</span>)
</code></pre>
<h2>User interactions</h2>
<pre><code class="hljs language-py">...

message_label = tk.Label(master=window, text=<span class="hljs-string">""</span>)
message_label.pack()

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">display_message</span>():</span>
    message_label.config(text=<span class="hljs-string">"Hello!"</span>)

hello_button = tk.Button(master=window,
                              text=<span class="hljs-string">"Say Hello!"</span>,
                              command=display_message)
hello_button.pack()

...
</code></pre>
<h2>Application state and user interactions</h2>
<p>Application state is best stored inside a class.</p>
<h2>Application state and user interactions</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> tkinter <span class="hljs-keyword">as</span> tk

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CounterApp</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span>
        self.count = <span class="hljs-number">0</span>

        self.window = tk.Tk()
        self.count_btn = tk.Button(
            master=self.window,
            text=<span class="hljs-built_in">str</span>(self.count),
            command=self.increment_count
        )
        self.count_btn.pack()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">increment_count</span>(<span class="hljs-params">self</span>):</span>
        self.count += <span class="hljs-number">1</span>
        self.count_btn.config(text=<span class="hljs-built_in">str</span>(self.count))

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self</span>):</span>
        self.window.mainloop()

counter = CounterApp()
counter.run()
</code></pre>
<h2>Application state and user interactions</h2>
<p>Task: add a <em>reset</em> button to the counter</p>
<h2>Layouts</h2>
<p>Simple layouts in rows and columns via <code>.pack</code>:</p>
<pre><code class="hljs language-py">label.pack()
</code></pre>
<p>More complex layouts in grids:</p>
<pre><code class="hljs language-py">label_a.grid(column=<span class="hljs-number">0</span>, row=<span class="hljs-number">0</span>)
label_b.grid(column=<span class="hljs-number">0</span>, row=<span class="hljs-number">1</span>)
</code></pre>
<h2>Widget configuration</h2>
<p>config options:</p>
<ul>
<li><code>height</code> (in pixels or relative to the font size)</li>
<li><code>width</code></li>
<li><code>borderwidth</code></li>
<li><code>background</code> (background color)</li>
<li><code>foreground</code> (text color)</li>
<li><code>justify</code> (text alignment, e.g. <code>tk.CENTER</code>, <code>tk.LEFT</code>, <code>tk.RIGHT</code>)</li>
<li><code>padx</code>, <code>pady</code> (distance between the border and the content)</li>
<li><code>font</code> (e.g.: <code>("Arial", 16)</code>)</li>
</ul>
<h2>Widgets</h2>
<ul>
<li><code>Label</code></li>
<li><code>Button</code></li>
<li><code>Frame</code></li>
<li><code>Entry</code></li>
</ul>
<h2>Examples</h2>
<ul>
<li>Snellen chart</li>
<li>Tic-Tac-Toe</li>
</ul>
<h1>PyInstaller</h1>
<h2>PyInstaller</h2>
<p>Enables creating <em>.exe</em> files from Python projects</p>
<p>Especially useful for GUI applications</p>
<h2>PyInstaller - Usage</h2>
<p>Installation:</p>
<pre><code class="hljs language-bash">pip install pyinstaller
</code></pre>
<h2>PyInstaller - Usage</h2>
<p>Creating an executable application:</p>
<pre><code class="hljs language-bash">pyinstaller app.pyw --onefile --windowed
</code></pre>
<p>Result: <em>dist/app.exe</em></p>
<h1>SMTP / IMAP</h1>
<h2>SMTP / IMAP</h2>
<p><a href="https://automatetheboringstuff.com/chapter16/">https://automatetheboringstuff.com/chapter16/</a></p>
<p>(for error corrections see next slide)</p>
<p>for hidden password entry: use module <em>getpass</em></p>
<h2>SMTP / IMAP</h2>
<p>Errors in the resource:</p>
<p>provide the query as two entries:</p>
<p><del><code>UIDs = imapObj.search(['SINCE 05-Jul-2014'])</code></del></p>
<p><code>UIDs = imapObj.search(['SINCE', '05-Jul-2014'])</code></p>
<p>use newer version of <em>pyzmail</em>:</p>
<p><del><code>pyzmail</code></del> → <code>pyzmail36</code></p>
<p>use bytes instead of a string:</p>
<p><del><code>'BODY[]'</code></del> → <code>b'BODY[]</code></p>